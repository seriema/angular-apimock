/*! Angular API Mock v0.3.1
 * Licensed with MIT
 * Made with â™¥ from Seriema + Redhorn */
angular.module("apiMock",[]).config(["$httpProvider",function(a){a.interceptors.push("httpInterceptor")}]).provider("apiMock",function(){function a(a){var b=[];return angular.forEach(a,function(a,c){b.push(c)}),b}function b(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+(a.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}function c(b,c,d){for(var e=a(b).sort(),f=0;f<e.length;f++)c.call(d,b[e[f]],e[f]);return e}function d(a){return angular.isDate(a)?b(a):a}function e(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function f(a){function b(a,g,h){angular.isArray(a)?angular.forEach(a,function(a,c){b(a,g+"["+(angular.isObject(a)?c:"")+"]")}):angular.isObject(a)&&!angular.isDate(a)?c(a,function(a,c){b(a,g+(h?"":"[")+c+(h?"":"]"))}):void 0===a||""===a?f.push(e(g)):f.push(e(g)+"="+e(d(a)))}var f=[];return b(a,"",!0),f.join("&")}function g(a){if(!a)return{};var b=a.split("&"),c={};return angular.forEach(b,function(a){a=a.split("="),c[a[0]]=a[1]||""}),c}function h(a){var b,c=/apimock/i;return angular.forEach(a,function(a,d){c.test(d)&&(b=a)}),b}function i(a){return h(a)}function j(a){var b=i(a);return void 0===b&&(b=l()),void 0===b&&(b=x.defaultMock),b}function k(a){switch((a||"").toString().toLowerCase()){case"200":case"404":case"500":return{type:"respond",value:parseInt(a,10)};case"auto":return{type:"recover"};case"true":return{type:"reroute"}}return{type:"ignore"}}function l(){return h(t.search())}function m(a){var b={status:a,headers:{"Content-Type":"text/html; charset=utf-8",Server:"Angular ApiMock"}};return u.info("apiMock: mocking HTTP status to "+a),v.reject(b)}function n(a){return void 0!==o(a,x.apiPath)}function o(a,b){var c;return angular.isArray(b)&&angular.forEach(b,function(b){if(!c){var d=o(a,b);d&&(c=d)}}),c?c:b instanceof RegExp&&b.test(a)?b:0===a.toString().indexOf(b)?b:c}function p(a){n(a.url)&&y.push(a)}function q(a){var b=y.length;return y=w("filter")(y,{method:"!"+a.method,url:"!"+a.url},!0),b>y.length}function r(a){if(!n(a.url))return a;var b=a.url,c=a.url.replace(o(a.url,x.apiPath),x.mockDataPath),d=c.split("?"),e=d[0],h=d[1]||"";if(!x.stripQueries){var i=g(h),j=angular.extend(a.params||{},i);"/"!==e[e.length-1]&&(e+="/"),e+=angular.lowercase(f(j))}return a.params=void 0,"/"===e[e.length-1]&&(e=e.slice(0,-1)),e+="."+a.method.toLowerCase()+".json",a.method="GET",a.url=e,u.info("apiMock: rerouting "+b+" to "+e),a}function s(a,b,c,d){t=a,u=b,v=c,w=d}var t,u,v,w,x={defaultMock:!1,mockDataPath:"/mock_data",apiPath:"/api",disable:!1,stripQueries:!0,delay:0},y=[],z=s.prototype;z._countFallbacks=function(){return y.length},z.getDelay=function(){return x.delay},z.onRequest=function(a){if(x.disable)return a;var b=j(a),c=k(b);switch(c.type){case"reroute":return r(a);case"recover":return p(a),a;case"respond":return m(c.value);case"ignore":default:return a}},z.onResponse=function(a){return q(a),a},z.recover=function(a){return x.disable?!1:void 0===a.config?!1:q(a.config)?(u.info("apiMock: recovering from failure at "+a.config.url),r(a.config)):!1},this.config=function(a){angular.extend(x,a)},this.$get=["$location","$log","$q","$filter",function(a,b,c,d){return new s(a,b,c,d)}]}).service("httpInterceptor",["$injector","$q","$timeout","apiMock",function(a,b,c,d){this.request=function(a){return d.onRequest(a)},this.response=function(a){var e=b.defer();return c(function(){e.resolve(d.onResponse(a))},d.getDelay(),!0),e.promise},this.responseError=function(e){var f=b.defer();return c(function(){var b=d.recover(e);if(b){var c=a.get("$http");c(b).then(function(a){f.resolve(a)})}else f.reject(e)},d.getDelay(),!0),f.promise}}]);