/*! Angular API Mock v0.3.0
 * Licensed with MIT
 * Made with â™¥ from Seriema + Redhorn */
angular.module("apiMock",[]).config(["$httpProvider",function(a){a.interceptors.push("httpInterceptor")}]).provider("apiMock",function(){function a(a){var b=[];return angular.forEach(a,function(a,c){b.push(c)}),b}function b(b,c,d){for(var e=a(b).sort(),f=0;f<e.length;f++)c.call(d,b[e[f]],e[f]);return e}function c(a){return angular.isObject(a)?angular.isDate(a)?a.toISOString():angular.toJson(a):a}function d(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function e(a){function e(a,g,h){null===a||angular.isUndefined(a)||(angular.isArray(a)?angular.forEach(a,function(a,b){e(a,g+"["+(angular.isObject(a)?b:"")+"]")}):angular.isObject(a)&&!angular.isDate(a)?b(a,function(a,b){e(a,g+(h?"":"[")+b+(h?"":"]"))}):f.push(d(g)+"="+d(c(a))))}if(!a)return"";var f=[];return e(a,"",!0),f.join("&")}function f(a){if(!a)return{};var b=a.split("&"),c={};return angular.forEach(b,function(a){a=a.split("="),c[a[0]]=a[1]||""}),c}function g(a){var b,c=/apimock/i;return angular.forEach(a,function(a,d){c.test(d)&&(b=a)}),b}function h(a){return g(a)}function i(a){var b=h(a);return void 0===b&&(b=k()),void 0===b&&(b=v.defaultMock),b}function j(a){switch((a||"").toString().toLowerCase()){case"200":case"404":case"500":return{type:"respond",value:parseInt(a,10)};case"auto":return{type:"recover"};case"true":return{type:"reroute"}}return{type:"ignore"}}function k(){return g(s.search())}function l(a){var b={status:a,headers:{"Content-Type":"text/html; charset=utf-8",Server:"Angular ApiMock"}};return t.info("apiMock: mocking HTTP status to "+a),u.reject(b)}function m(a){return void 0!==n(a,v.apiPath)}function n(a,b){var c;return angular.isArray(b)&&angular.forEach(b,function(b){if(!c){var d=n(a,b);d&&(c=d)}}),c?c:b instanceof RegExp&&b.test(a)?b:0===a.toString().indexOf(b)?b:c}function o(a){m(a.url)&&w.push(a)}function p(a){var b=!1;return angular.forEach(w,function(c,d){c.method===a.method&&c.url===a.url&&(b=!0,w.splice(d,1))}),b}function q(a){if(!m(a.url))return a;var b=a.url,c=a.url.replace(n(a.url,v.apiPath),v.mockDataPath),d=c.split("?"),g=d[0],h=d[1]||"";if(!v.stripQueries){var i=f(h),j=angular.extend(a.params||{},i);"/"!==g[g.length-1]&&(g+="/"),g+=angular.lowercase(e(j))}return a.params=void 0,"/"===g[g.length-1]&&(g=g.slice(0,-1)),g+="."+a.method.toLowerCase()+".json",a.method="GET",a.url=g,t.info("apiMock: rerouting "+b+" to "+g),a}function r(a,b,c){s=a,t=b,u=c}var s,t,u,v={defaultMock:!1,mockDataPath:"/mock_data",apiPath:"/api",disable:!1,stripQueries:!0,delay:0},w=[],x=r.prototype;x._countFallbacks=function(){return w.length},x.getDelay=function(){return v.delay},x.onRequest=function(a){if(v.disable)return a;var b=i(a),c=j(b);switch(c.type){case"reroute":return q(a);case"recover":return o(a),a;case"respond":return l(c.value);case"ignore":return a;default:return a}},x.onResponse=function(a){return v.disable?a:(p(a),a)},x.recover=function(a){return v.disable?!1:void 0===a.config?!1:p(a.config)?(t.info("apiMock: recovering from failure at "+a.config.url),q(a.config)):!1},this.config=function(a){angular.extend(v,a)},this.$get=["$location","$log","$q",function(a,b,c){return new r(a,b,c)}]}).service("httpInterceptor",["$injector","$q","$timeout","apiMock",function(a,b,c,d){this.request=function(a){return a=d.onRequest(a),a||b.when(a)},this.response=function(a){var e=b.defer();return c(function(){e.resolve(d.onResponse(a))},d.getDelay(),!0),e.promise},this.responseError=function(e){var f=b.defer();return c(function(){var b=d.recover(e);if(b){var c=a.get("$http");c(b).then(function(a){f.resolve(a)})}else f.reject(e)},d.getDelay(),!0),f.promise}}]);