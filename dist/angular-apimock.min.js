/*! Angular API Mock v0.2.0
 * Licensed with MIT
 * Made with â™¥ from Seriema + Redhorn */
angular.module("apiMock",[]).config(["$httpProvider",function(a){a.interceptors.push("httpInterceptor")}]).provider("apiMock",function(){function a(a){var b=[];return angular.forEach(a,function(a,c){b.push(c)}),b}function b(b,c,d){for(var e=a(b).sort(),f=0;f<e.length;f++)c.call(d,b[e[f]],e[f]);return e}function c(a){return angular.isObject(a)?angular.isDate(a)?a.toISOString():angular.toJson(a):a}function d(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function e(a){function e(a,g,h){null===a||angular.isUndefined(a)||(angular.isArray(a)?angular.forEach(a,function(a,b){e(a,g+"["+(angular.isObject(a)?b:"")+"]")}):angular.isObject(a)&&!angular.isDate(a)?b(a,function(a,b){e(a,g+(h?"":"[")+b+(h?"":"]"))}):f.push(d(g)+"="+d(c(a))))}if(!a)return"";var f=[];return e(a,"",!0),f.join("&")}function f(a){if(!a)return{};var b=a.split("&"),c={};return angular.forEach(b,function(a){a=a.split("="),c[a[0]]=a[1]||""}),c}function g(a){var b,c=/apimock/i;return angular.forEach(a,function(a,d){c.test(d)&&(b=a)}),b}function h(a){return g(a)}function i(a){var b=h(a);return void 0===b&&(b=k()),b}function j(a){switch(typeof a){case"number":if(0!==a&&!isNaN(a))return{type:"respond",value:a};break;case"string":switch(a.toLowerCase()){case"auto":return{type:"recover"};case"true":return{type:"reroute"}}break;case"boolean":if(a===!0)return{type:"reroute"}}return{type:"ignore"}}function k(){return g(r.search())}function l(a){var b={status:a,headers:{"Content-Type":"text/html; charset=utf-8",Server:"Angular ApiMock"}};return s.info("apiMock: mocking HTTP status to "+a),t.reject(b)}function m(a){return 0===a.indexOf(u.apiPath)}function n(a){m(a.url)&&v.push(a)}function o(a){var b=!1;return angular.forEach(v,function(c,d){c.method===a.method&&c.url===a.url&&(b=!0,v.splice(d,1))}),b}function p(a){if(!m(a.url))return a;var b=a.url,c=a.url.replace(u.apiPath,u.mockDataPath),d=c.split("?"),g=d[0],h=d[1]||"";if(!u.stripQueries){var i=f(h),j=angular.extend(a.params||{},i);"/"!==g[g.length-1]&&(g+="/"),g+=angular.lowercase(e(j))}return a.params=void 0,"/"===g[g.length-1]&&(g=g.slice(0,-1)),g+="."+a.method.toLowerCase()+".json",a.method="GET",a.url=g,s.info("apiMock: rerouting "+b+" to "+g),a}function q(a,b,c){r=a,s=b,t=c}var r,s,t,u={mockDataPath:"/mock_data",apiPath:"/api",disable:!1,stripQueries:!0,delay:0},v=[],w=q.prototype;w._countFallbacks=function(){return v.length},w.getDelay=function(){return u.delay},w.onRequest=function(a){if(u.disable)return a;var b=i(a),c=j(b);switch(c.type){case"reroute":return p(a);case"recover":return n(a),a;case"respond":return l(c.value);case"ignore":return a;default:return a}},w.onResponse=function(a){return u.disable?a:(o(a),a)},w.recover=function(a){return u.disable?!1:void 0===a.config?!1:o(a.config)?(s.info("apiMock: recovering from failure at "+a.config.url),p(a.config)):!1},this.config=function(a){angular.extend(u,a)},this.$get=["$location","$log","$q",function(a,b,c){return new q(a,b,c)}]}).service("httpInterceptor",["$injector","$q","$timeout","apiMock",function(a,b,c,d){this.request=function(a){return a=d.onRequest(a),a||b.when(a)},this.response=function(a){var e=b.defer();return c(function(){e.resolve(d.onResponse(a))},d.getDelay(),!0),e.promise},this.responseError=function(e){var f=b.defer();return c(function(){var b=d.recover(e);if(b){var c=a.get("$http");c(b).then(function(a){f.resolve(a)})}else f.reject(e)},d.getDelay(),!0),f.promise}}]);